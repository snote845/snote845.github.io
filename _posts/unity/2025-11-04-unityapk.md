---
layout: post
title: "Unity æ‰“åŒ… Apk ç ”ç©¶"
date: 2025-11-04 20:15:00 +0800
categories: [Unity, apk, Android]
tags: [Android, Unity, apk]
---

### Part 1:Unity æ„å»º Androidçš„é¡¹ç›®ç»“æ„

#### Unity æ„å»º Android ä¸»è¦ç”±ä¸¤ä¸ªmodule ç»„æˆ
* launcher
* unityLibrary

æ¸¸æˆä»£ç ï¼ˆC# è„šæœ¬ï¼‰å’Œå¤§éƒ¨åˆ†æ’ä»¶éƒ½ä½äº unityLibrary æ¨¡å—ä¸­ï¼Œè€Œ mainTemplate.gradle æ­£æ˜¯ç”¨æ¥é…ç½®è¿™ä¸ªæ¨¡å—çš„ã€‚launcherTemplate.gradle åªé…ç½®é‚£ä¸ªå¯åŠ¨æ¸¸æˆçš„â€œç©ºå£³â€åº”ç”¨ã€‚

#### Unity çš„å·¥ä½œæµç¨‹        
1ï¼Œç”Ÿæˆä¸´æ—¶ Android Gradle é¡¹ç›®     
2ï¼Œå¡«å……æ¨¡æ¿     
3ï¼Œå˜é‡æ›¿æ¢ **VARIABLE_NAME**ï¼Œæ›¿æ¢ä¸º Player Settings ä¸­é…ç½®çš„å€¼        
4ï¼Œè°ƒç”¨ Gradle æ‰§è¡Œç¼–è¯‘ï¼Œç”Ÿæˆ APK æˆ– AAB        

|å ä½ç¬¦å˜é‡ (åœ¨ .gradle æ–‡ä»¶ä¸­)|å¯¹åº”çš„ Unity Player Setting|ç¤ºä¾‹å€¼|
|---|---|---|
|`**APPLICATION_ID**`|**Package Name**Â (åŒ…å)|`com.mycompany.mygame`|
|`**BUNDLE_VERSION_CODE**`|**Bundle Version Code**(å†…éƒ¨ç‰ˆæœ¬å·)|`1`,Â `2`,Â `10`|
|`**VERSION_NAME**`|**Version**Â (å¤–éƒ¨ç‰ˆæœ¬å)|`1.0`,Â `2.1.3`|
|`**MIN_SDK_VERSION**`|**Minimum API Level**Â (æœ€ä½ API çº§åˆ«)|`22`|
|`**TARGET_SDK_VERSION**`|**Target API Level**Â (ç›®æ ‡ API çº§åˆ«)|`33`|
|`**UNITY_PLAYER_NAME**`|**Product Name**Â (äº§å“åç§°)|`My Awesome Game`|
|`**UNITY_COMPANY_NAME**`|**Company Name**Â (å…¬å¸åç§°)|`My Company`|
|`**SPLITS_ENABLED**`|**Split APKs by architecture**(ARMv7, ARM64)|`true`Â æˆ–Â `false`|
|`**IL2CPP_DEVELOPMENT_BUILD**`|**Development Build**Â (å¼€å‘æ„å»º)|`true`Â æˆ–Â `false`|

### Part 2: å¦‚ä½•ç”Ÿæˆå’Œä½¿ç”¨è‡ªå®šä¹‰ Gradle æ¨¡æ¿ï¼Ÿ
1. **æ‰“å¼€ Player Settings**:Â `Edit > Project Settings > Player`ã€‚
2. **åˆ‡æ¢åˆ° Android æ ‡ç­¾é¡µ**Â ğŸ¤–ã€‚
3. **`å±•å¼€Â Publishing Settings`**:
4. åœ¨è¿™é‡Œï¼Œä½ ä¼šçœ‹åˆ°å‡ ä¸ªç”¨äºè‡ªå®šä¹‰æ„å»ºçš„é€‰é¡¹ã€‚å‹¾é€‰å®ƒä»¬ï¼š
	1. **Custom Main Manifest**Â -> ç”ŸæˆÂ `AndroidManifest.xml`
	2. **Custom Main Gradle Template**Â -> ç”ŸæˆÂ `mainTemplate.gradle`
	3. **Custom Launcher Gradle Template**Â -> ç”ŸæˆÂ `launcherTemplate.gradle`
	4. **Custom Base Gradle Template**Â -> ç”ŸæˆÂ `baseProjectTemplate.gradle`
	5. Custom  Gradle Settings Template - > ç”Ÿæˆ settingsTemplate.gradle
	6. å…¶ä»–çš„æ ¹æ®é¡¹ç›®éœ€è¦ç”Ÿæˆ

- æ ¸å¿ƒå°±æ˜¯å°†å¯¼å‡º Android Projectä¸­çš„èµ„æºæ‰“åŒ…ï¼Œcopy åˆ° Unity Assets/Plugins/Androidä¸­

### Part 3: æ ‡å‡†çš„è‡ªå®šä¹‰Â `build.gradle`Â é…ç½®æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ
#### 1.Â `mainTemplate.gradle`Â - æ ¸å¿ƒæ¨¡å—é…ç½®
è¿™ä¸ªæ–‡ä»¶å¯¹åº”çš„æ˜¯Â `unityLibrary`Â æ¨¡å—çš„Â `build.gradle`ã€‚ç»å¤§å¤šæ•°è‡ªå®šä¹‰éœ€æ±‚ï¼Œæ¯”å¦‚**æ·»åŠ ä¾èµ–åº“**ï¼Œéƒ½åœ¨è¿™é‡Œå®Œæˆã€‚
ä¸€ä¸ªæ ‡å‡†çš„å¸¦æœ‰æ³¨é‡Šçš„Â `mainTemplate.gradle`Â å¦‚ä¸‹ï¼š
```
// mainTemplate.gradle (for unityLibrary module)

// å£°æ˜è¿™æ˜¯ä¸€ä¸ª Android åº“æ¨¡å—
apply plugin: 'com.android.library'

// (å¯é€‰) å¦‚æœä½ ä½¿ç”¨ Kotlinï¼Œéœ€è¦æ·»åŠ è¿™ä¸ªæ’ä»¶
// apply plugin: 'kotlin-android'

dependencies {
    // Unity é»˜è®¤çš„ä¾èµ–
    implementation fileTree(dir: 'libs', include: ['*.jar'])

    // ============== è‡ªå®šä¹‰åŒºåŸŸå¼€å§‹ ==============
    // åœ¨è¿™é‡Œæ·»åŠ ä½ çš„åŸç”Ÿ Android åº“ä¾èµ–
    // ä¾‹å¦‚ï¼Œæ·»åŠ  Google Play Core åº“
    // implementation 'com.google.android.play:core:1.10.3'

    // ä¾‹å¦‚ï¼Œæ·»åŠ ä¸€ä¸ªç¬¬ä¸‰æ–¹å¹¿å‘Š SDK
    // implementation 'com.some.ad.sdk:sdk-core:3.2.1'
    // ============== è‡ªå®šä¹‰åŒºåŸŸç»“æŸ ==============

    **DEPS** // <-- è¿™ä¸ªå ä½ç¬¦å¾ˆé‡è¦ï¼ŒUnity ä¼šç”¨å®ƒæ¥æ³¨å…¥å…¶ä»–å†…éƒ¨ä¾èµ–ï¼Œå¿…é¡»ä¿ç•™ï¼
}

android {
    // ç¼–è¯‘ç”¨çš„ SDK ç‰ˆæœ¬
    compileSdkVersion **SDK_VERSION**
    // æ„å»ºå·¥å…·ç‰ˆæœ¬
    buildToolsVersion '**BUILD_TOOLS_VERSION**'

    // é»˜è®¤é…ç½®å—ï¼Œè¿™é‡Œçš„å˜é‡ä¼šè¢« Unity æ›¿æ¢
    defaultConfig {
        // ä½¿ç”¨ Unity çš„åŒ…åå ä½ç¬¦
        // æ³¨æ„ï¼šåº“æ¨¡å—é€šå¸¸ä¸è®¾ç½® applicationIdï¼Œä½†å¦‚æœè®¾ç½®äº†ï¼Œå®ƒåº”è¯¥ä¸ä¸»æ¨¡å—ä¸€è‡´
        // applicationId '**APPLICATION_ID**'

        // ä½¿ç”¨ Unity çš„æœ€ä½/ç›®æ ‡ SDK ç‰ˆæœ¬å ä½ç¬¦
        minSdkVersion **MIN_SDK_VERSION**
        targetSdkVersion **TARGET_SDK_VERSION**
        
        // ä½¿ç”¨ Unity çš„ç‰ˆæœ¬å·å ä½ç¬¦
        versionCode **BUNDLE_VERSION_CODE**
        versionName '**VERSION_NAME**'

        consumerProguardFiles 'proguard-unity.txt', 'proguard-user.txt'
    }

    // è®¾ç½® Java æºç çš„å…¼å®¹æ€§
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }

    // Unity è‡ªåŠ¨ç”Ÿæˆçš„ç­¾åé…ç½®ï¼Œè®©å®ƒä¿æŒåŸæ ·
    signingConfigs {
        release {
            storeFile file(project.property('unity.keystore.path'))
            storePassword project.property('unity.keystore.password')
            keyAlias project.property('unity.keyalias.name')
            keyPassword project.property('unity.keyalias.password')
        }
    }

    // æ„å»ºç±»å‹é…ç½®
    buildTypes {
        debug {
            minifyEnabled false
            debuggable true
        }
        release {
            // ä½¿ç”¨ Unity çš„ç­¾åé…ç½®
            signingConfig signingConfigs.release
            minifyEnabled true // å¼€å¯æ··æ·†å’Œå‹ç¼©
            // ProGuard è§„åˆ™æ–‡ä»¶
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-unity.txt', 'proguard-user.txt'
        }
    }
    
    // aapt é€‰é¡¹ï¼Œä¿æŒé»˜è®¤
    aaptOptions {
        noCompress = ['.unity3d', '.ress', '.resource', '.obb'**NO_COMPRESS_EXTENSIONS**]
        ignoreAssetsPattern = "!.svn:!.git:!.ds_store:!*~:!*.bak:!*.orig:!*.*.meta:"
    }
}

```

### Q&A
#### 1.Unity å¯¼å‡º Android ç»§æ‰¿GameActivityçš„å¯åŠ¨ç±»ï¼Ÿ
* ç¬¬ä¸€æ¬¡å¯¼å‡ºUnity çš„ AndroidProject é¡¹ç›®é»˜è®¤çš„å¯åŠ¨ç±»å’Œç°åœ¨å¯¼å‡ºçš„ Unity é»˜è®¤å¯åŠ¨ç±»æœ‰å·®å¼‚äº†ï¼Ÿ
Unity ç‰ˆæœ¬2023.2.20f1c1
 ç³»ç»Ÿ Mac
*  å½“å‰å¯¼å‡ºçš„é¡¹ç›®
	* Unity é»˜è®¤ä½¿ç”¨çš„å¯åŠ¨ç±»æ˜¯ com.unity3d.player.UnityPlayerGameActivity
	* UnityPlayerGameActivity ç»§æ‰¿çš„æ˜¯GameActivityï¼Œåœ¨ç±»åº“'androidx.games:games-activity:3.0.0'ä¸­
* é¦–æ¬¡å¯¼å‡ºçš„
	* com.unity3d.player.UnityPlayerActivity
	* UnityPlayerActivity é»˜è®¤ç»§æ‰¿çš„æ˜¯ Activityï¼Œmoduleé¡¹ç›® unitylibraryæ²¡æœ‰å¼•å…¥å…¶ä»–ç±»åº“

    
å‚è€ƒ[å®˜æ–¹æ–‡æ¡£](https://docs.unity3d.com/6000.2/Documentation/Manual/android-application-entries-set.html)äº†è§£æ›´å¤šç»†èŠ‚ã€‚
* Unity â†’ File â†’ Build Settings â†’ Player Settings â†’ Player â†’ Other Settings 
* æ‰¾åˆ° Application Entry Point
	* Activity é‡‡ç”¨ Activity æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯com.unity3d.player.UnityPlayerActivityï¼Œé»˜è®¤ç»§æ‰¿ Activity
	* GameActivityï¼Œé»˜è®¤å¯¼å‡ºä¸‰æ–¹åº“androidx.games:games-activity:3.0.0ï¼Œé»˜è®¤ç»§æ‰¿ GameActivity

#### 2.Unity æ‰“åŒ… apk æ—¶ï¼Œåˆå¹¶ AndroidManifest.xmlæ—¶æŠ¥é”™ï¼Ÿ
- æ— æ³•è‡ªåŠ¨è§£æå¹¶åˆå¹¶ AAR ä¸è¿œç¨‹ä¾èµ–åº“ä¸­çš„ AndroidManifest.xmlï¼Œè‡³å°‘ç›®å‰æ˜¯æ²¡æœ‰è§£æåˆå¹¶å…¥ LauncherAndroidManifest.xml ä¸­ï¼Ÿ
* æ˜¯ LauncherManifest.xml ä¸­ Application  æ ‡ç­¾ä¸­å®šä¹‰çš„ tools:node="replace" å¯¼è‡´æ”¾å¼ƒäº†å…¶ä»–éä¸» module ä¸­çš„ AndroidManifest.xml åˆå¹¶
* è§£å†³æ–¹æ¡ˆæ˜¯ä¸èƒ½ä½¿ç”¨ tools:node="replace"å±æ€§ï¼Œå°†é»˜è®¤æ·»åŠ çš„é‚£ä¸ª MAIN å…¥å£ç±»è®¾ç½®å±æ€§ tools:node="remove" å³å¯
```xml
    <activity
        android:name="com.unity3d.player.UnityPlayerActivity"
        tools:node="remove" />
```



